# Интруемент контроля и поддержания актулальности списка электронных компонентов 

## Техничесике требования 

- Создание базы компонентов из существующего файла в BOM формате 
- Регистрация точки доступа и аутентификация при доступе к базе данных
- Периодическое обращения к efind API для подтверждения доступности компонентов
- Уведомление пользователя при изменении статуса доступности компонента 
- Создание группы пользовтелей с ограниченным доступом к списку 
- Предоставление вариантов возможной альтернативы недоступному компоненту 
- Возможность добавлять и удалять отдельные компоненты из списка отслеживаемых

# Пример уведомления  
[example.md](example.md)

# Схема взаимодействия

1. Регистрация нового пользователя/точки доступа 
2. Создание нового списка компонентов из JSON или существующего BOM файла 
3. Сервис периодически делает запросы к API Efind, чтобы получить информацию о доступности компонента в списке
4. При изменении статуса доступности пользователю приходит уведомление с возможными альтернативами недоступному компоненту из списка 
5. Автор списка может создать группу пользователей с ограниченным доступом к списку
6. Пользователь может просматривать/добавлять/удалять компоненты в списке, если пользователь состоит в группе, имеющую необходимую степень доступа 
7. Добавить несколько компонентов к существубщему списку можно в JSON формате или из BOM файла, при этом в список будут загружены только новые компоненты
8. Пользователь может создавать несколько списков компонентов тогда ему будет возможно создать группу пользователей с доступом сразу к нескольким спискам

# User story 

Как **менеджер по закупкам**
я могу добавить компоненты из уже существующего файла BOM, 
чтобы легко следить за доступностью компонентов и получать уведомления изменении статуса актульности

Как **инженер конструктор (электронщик)** я могу добавить в существующий список компоненты из BOM проекта, 
чтобы следить за их актулальностью, рассматривать альтернативы предложеные сервисом в случае недоступности 
компонента из списка 

## Описание методов API 
### Работа со списками отслеживаемых компонентов 
- ``` POST api/list ``` создать новый список компонентов, ответ - ID нового списка
- ``` GET api/list/{list ID}?pageNum={page number}&pageSize={page size} ``` получить весь список по ID/принудиьельно обновить список 
### Работа с компонентами в списке 
- ``` POST api/list/{list ID}``` добавить компонент в список в формате JSON 
> возмлжно лучше использовать  ``` PUT/PATCH ```
- ``` POST api/list/{list ID}/batch ``` добавить несколько компонентов в формате JSON 
- ``` POST api/list/{list ID}/bom ``` добавить все новые компоненты из файла BOM в список
- ``` PUT api/list/{list ID}/ ``` удалить компонент в формате JSON в теле запроса из списка отслеживаемых  
### Работа со схемами хранения
- ``` GET api/list/{list ID}/schema``` получить данные о схеме хранения списка по ID 
- ``` POST api/list/{list ID}/schema``` изменить данные о схеме хранения списка по ID

### Добавление EMail к API токену 
- ``` POST api/login ``` привязать  email  в теле запроса к API токену в ответе

###  Пример работы с сервисом
0. Получение API токена 
``` POST api/login``` - тело запроса дожно содержать адрес EMail, на который будут приходить уведомления
ответ -   JWT токен, котрый при использовании функций сервиса должен находится в заголовке запроса ```"Token"```

1. Создание нового списка 

``` POST api/list ``` ответ - ID списка 

2. Добавление компонентов из файла BOM 

``` POST api/list/id={list ID}/bom ``` тело запроса должно быть файлом в формате 
.csv

Название компонента должно находиться в поле с названием ```part name```

3. Изменение схемы хранения
При появлении нового списка для него автоматически создается схема хранения информаии
Получить текущую схему хранения:
``` GET api/list/{list ID}/schema```
Ответом сервера будет JSON cтруктура стандартных опций хранения

``` json
{
    "id": "<ID списка>",
    "numberField": "<название поля списка с порядковым номером компонента>",
    "nameField": "<название поля списка с названием компонента>",
    "region": int<[ID региона](regions.md), в котором комопонент должен быть доступен>
    "fieldNames": [
        "<поле списка 1>",
        "<поле списка 2>",
        "<поле списка 3>"
    ]
}
```
Схема хранения компонентов в списке содержит информацию о полях компонентов и дополнительных параметров проверки доступности. Регион для проверки при создании определится как Россия, ID для всех доступных регионов [здесь](regions.md)

Новую схему храния загрузить в сервис можно с помощью
``` GET api/list/{list ID}/schema```

## Road map 
План развития сервиса

## Высылать токены, комоненты пряио на EMail в красивом письме, а не преступлении против современного веб-дизайна в формате  HTML

## Добавение работы с пользователями 
- ``` POST api/user ``` создать нового пользователя/точку досупа к списку отслежеваемых компонентов, ответ - ID новго пользователя 
- ``` POST api/user/login ``` аутентификация пользователя
- ``` POST api/user/email ``` сменить e-mail  для уведомлений текущего пользователя  
- ``` GET api/user/group ``` получить информацию о группах, в которых состоит текущий пользователь
- ``` POST api/user/group/{group name} ``` создать новую группу пользователей 
- ``` GET api/user/{group name} ``` получить информацию о группе ползователей 
- ``` POST api/user/{group name}/add ``` добавить пользователя/пользователей в группу 
- ``` POST api/user/{group name}/permissions ```  изменить степень доступа к спискам каждого пользовтаеля в группе 
- ``` GET api/user/{group name}/permissions ``` получить степени доступа к спискам каждого пользователя в группе 
- ``` GET api/user/id={user ID} ``` получить информаию о пользователе с таким ID
- ``` DELETE api/user/group/{group name} ``` удалить группу пользователей 
- ``` DELETE api/user/id={user ID} ``` удалить пользователя 

